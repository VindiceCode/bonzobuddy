# Bonzo Buddy: Technical and Functional Specification

## 1. Core Philosophy & Purpose

Bonzo Buddy is a local, graphical desktop application designed to be a comprehensive testing and development utility for webhook integrations. Its primary purpose is to provide a stable, intuitive, and powerful environment for developers to:
*   **Simulate** incoming webhook payloads from various integration partners.
*   **Test** the receiving system's ability to parse different data formats and variations.
*   **Verify** de-duplication and contact merging logic.
*   **Streamline** the developer workflow by providing quick access to relevant system pages and credentials.
*   **Document and extend** payload schemas through a user-friendly interface.

The application is built on the principle of **convention over configuration**, using a specific directory structure (`webhook_payload_docs/`) as the single source of truth for its knowledge of integrations and their data formats.

## 2. Application Architecture

The application is built with Python and the `customtkinter` library, and is structured into three main logical components:

*   **`gui.py` (The View & Controller):** This is the heart of the application, responsible for rendering the entire user interface and handling all user interactions (button clicks, selections, etc.). It acts as the central controller, orchestrating the flow of data between the user and the other two components.
*   **`data_manager.py` (The Model):** This module is the sole interface to the application's "database"â€”a set of simple, human-readable JSON files. It is responsible for all file I/O, including reading, writing, and updating the application's state. This separation of concerns ensures that the GUI is never directly responsible for data persistence.
*   **`payload_generator.py` (The Engine):** This module is a dedicated engine for dynamically creating JSON payloads. It takes a schema file and a set of dynamic data (like a prospect's name and email) and constructs a valid payload string.

## 3. Data Model & Persistence

Bonzo Buddy uses a simple, file-based persistence model composed of three key JSON files:

1.  **`org_webhooks.json`:** This is the primary configuration file. It stores an array of "organization" objects. Each object has the following structure:
    *   `id`: The unique Organization ID (e.g., "12578").
    *   `name`: A human-readable name for the organization (e.g., "Starters Demo").
    *   `owner_id`: The ID of the user who "owns" this test organization, used for generating direct links.
    *   `webhooks`: An array of webhook objects, each with a `name` and a `url`.

2.  **`generated_prospects.json`:** This file acts as a stateful record of all prospects generated by the tool. It is an object where each key is an `org_id`. This ensures that all generated data is **scoped to a specific organization**. Each organization's object contains:
    *   `next_prospect_index`: An integer that increments with each new prospect, used to generate unique names and emails (e.g., `Prospect1`, `Prospect2`).
    *   `prospects`: An array of objects, where each object represents a prospect that has been **successfully sent and saved**, containing their `firstName`, `lastName`, `email`, and `phone`.

3.  **Secure Credential Storage (`keyring`):** Passwords are **never** stored in the JSON files. The application uses the `keyring` library to interface with the operating system's native, secure keychain. Passwords are stored using a service name (`BonzoBuddy`) and the `org_id` as the username, ensuring they are handled securely.

## 4. The User Interface & Workflow

The application is presented in a professional, three-column dark-mode interface that guides the user through a logical, step-by-step workflow.

### Column 1: Organization Context
*   **Purpose:** To establish the context for the entire testing session.
*   **Components:**
    *   A scrollable list of all configured **Organizations**.
    *   **"Add Organization" Button:** Opens a popup to add a new organization, requiring a Name, Org ID, and Owner ID.
    *   **"Edit Organization" Button:** Opens a popup to edit the ID and Owner ID of the *currently selected* organization.
    *   **"Open Team in Bonzo" Button:** Constructs a URL using the selected `org_id` and opens the team page.
    *   **"Open Owner in Bonzo" Button:** Constructs a URL using the selected `owner_id` and opens the user page.
    *   **"Set/Update Password" Button:** Opens a secure popup to save a password to the OS keychain for the selected `org_id`.
    *   **"Copy Password" Button:** Retrieves the password for the selected `org_id` from the keychain and copies it to the clipboard.
*   **Workflow:** This column is the only active part of the UI on startup. Selecting an organization **enables Column 2**.

### Column 2: Webhook & Prospect Selection
*   **Purpose:** To select the specific endpoint and the data subject (prospect) for the test.
*   **Components:**
    *   A scrollable list of **Webhooks** that are *only* associated with the selected organization.
    *   **"Add Webhook" Button:** Opens an intelligent, tile-based wizard that guides the user through selecting an integration category and type before pasting a URL.
    *   **"Delete Webhook" Button:** Deletes the *currently selected* webhook.
    *   A scrollable list of **Existing Prospects** that have been previously generated and successfully sent for the selected organization.
*   **Workflow:** This column is enabled after an organization is selected. Selecting a webhook **enables Column 3**.

### Column 3: Action & Verification
*   **Purpose:** To generate, view, modify, and send the final payload.
*   **Components:**
    *   **"Payload Profile" Dropdown:** This is a context-aware dropdown that **only appears** if the selected integration has multiple `_schema.json` files in its directory. It allows the user to select which payload variation to generate.
    *   **"Generate New Prospect" Button:** Creates a new, unique prospect and generates a payload based on the selected webhook and profile. The new prospect is held in a "pending" state.
    *   **"Use Selected Prospect" Button:** Generates a payload using the data from the prospect selected in Column 2.
    *   **Payload Viewer:** A read-only text box that displays the generated JSON payload.
    *   **"Edit" Button:** Toggles the Payload Viewer between read-only and editable states.
    *   **"Send Payload" Button:** Sends the current content of the Payload Viewer to the selected webhook URL. If the send is successful (200 OK) and was for a "pending" prospect, that prospect is now saved permanently.
    *   **"Save as Custom Schema" Button:** This button **only appears** when the Payload Viewer is in "Edit Mode." It allows the user to save the (potentially modified) payload as a new, named schema file within a `custom_schemas` subdirectory for that integration.
*   **Workflow:** This column is enabled after a webhook is selected.
